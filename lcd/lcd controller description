LCD CONTROLLER:

*LCD controller contains the logic to transfer lcd image data 
from video buffer in system memory to lcd driver.

*It has dedicated DMA support to fetch image data from video 
buffer,then a video processing block takes that data and converts 
into suitable format and send to lcd driver via data ports.

*It has register bank of 17 register sets.example LCDCON1/2/3/4/5..

*It has TIMEGEN which consists of logic to generate control signals
for different lcd drivers.example VCLK,VM,VFRAME,VLINE,etc..


TIMING GENERATOR(TIMEGEN):
We will discuss briefly about the signals which are generated by timegen..
based on the register bank registers configuration,timegen will generate 
control signals.

Signals:>

VFRAME:
      It is a pulse which defines the duration of first line at frequency
once per frame. it is used to bring lcds line pointer to top of display to
start over.

*That means it is a pulse which will tell about the duration of displaying 
the first line at top.

VM: 
	This signal helps the driver to alternate the polarity of rows and 
column voltages.
ie. used to turn on or off the pixels.

This toggling rate depends on MMODE field in LCDCON1 register.
if
MMODE=0 then VM is configured to toggle on each frame.
if
MMODE=1 then VM is configured to toggle on each event elapsed by number of 
VLINE by MVAL in LCDCON2/4 register.
equation is 
	VM=VLINE/(MVAL*2)

*The VFRAME and VLINE pulse generation is relies on HOZVAL and LINEVAL field 
in LCDCON2/3 registers.

HOZVAL = (Horizontal display size / Number of the valid VD data line)-1
LINEVAL = (Vertical display size) -1: In case of single scan display type


VCLK: this signal depends on CLKVAL field in LCDCON1 register.

VCLK(Hz)=HCLK/(CLKVAL x 2)

standard HCLK value id 60MHz.

Like this we can get the frame rate by some unique expression..

frame_rate(Hz) = 1 / [ { (1/VCLK) x (HOZVAL+1)+(1/HCLK) x (A+B+(LINEBLANK x 8) ) } x ( LINEVAL+1) ]

A = 2(4+WLH), B = 2(4+WDLY)

where WLH is VLINE pulse width.
WDLY is the delay width of VCLK after VLINE pulse.


VIDEO OPERATION:>
LCD controller supprots so many modes.
ex: 8 bit color mode(256 color),12 bit color mode(4096 color),4 level gray scale
mode,16 level gray scale mode as well as the monochrome mode.

*For gray or color mode it requires shades of gray level or color according to an 
algorithm called dithering algorithm and FRC(frame rate control).
This selection of a shade or color is made by a lookup table.

LOOKUP TABLE:
take an example of 256 color mode..
In case of 256 color mode, 3 bits are allocated for red, 3 bits for green
and 2 bits for blue. The 256 colors mean that the colors are formed from 
the combination of 8 red, 8 green and 4 blue levels (8x8x4 = 256). In
the color mode, the lookup table can be used for suitable selections.

Gray Mode Operation:
LCD controller supports two gray modes
2-bit per pixel gray (4 level gray scale) and 4-bit per pixelgray (16 level gray scale).

The 2-bit per pixel gray mode uses a lookup table (BLUELUT).
this allows us to select 4 gray levels among 16.

The 2-bit per pixel gray lookup table uses the BULEVAL register in BLUELUT.
The gray level 0 will be denoted by BLUEVAL[3:0] value. If BLUEVAL[3:0] is 9,
level 0 will be represented by gray level 9 among 16 gray levels.if it is 15
then level 0 will be denoted by gray level 15 among 16 gray levels.

like this  level 1 will also be denoted by BLUEVAL[7:4], the level 2 by BLUEVAL[11:8], 
and the level 3 by BLUEVAL[15:12].

these 4 groups represents level 0,level 1,level 2,level 3.


256 Level Color Mode Operation:
LCD controller can support an 8-bit per pixel 256 color display mode.
that means it can represent 256 levels.
so it uses three look up tables for representing these levels.
REDLUT,GREENLUT,BLUELUT.
with combinations of these values it can represent a perticular level on display.
similar to gray level,REDLUT represents 8 groups,GREENLUT represents 8 groups,
BLUELUT represents 4 groups..[as 8*8*4=256 levels].


DITHERING AND FRAME RATE CONTROL:
to send  a video data to driver,it needs to be processed by dithering algorithm.
we need to see how it works..
ex:To display the third gray level from a
total of 16 levels, the 3 times pixel should be on and 13 times pixel off.
this is so-called gray level display by FRC.

DRAWBACK: if all pixels on first frame are turned on and all pixels on next frame are
turned off, the Flicker Noise will be maximized.
to reduce this, the average probability of pixel-on and -off between frames should be
the same.For that matter dithering algorithm introduced..

How this works we will take an example..
To represent the 14 gray level in the table, we should have a 6/7 duty cycle, 
which mean that there are 6 times pixel-on and one time pixel-off.
these specificatins are provided by datasheet in a table.


Display Types:
The LCD controller supports 3 types of LCD drivers: 4-bit dual scan, 4-bit single scan, 
and 8-bit single scan display mode.

to see how it works we need to see timing diagrams and memory diagrams in datasheet.


s3c2440 datasheet provides the address of the registers which are needed and fields 
that each register contains.

so i got some information about registers:

(I):> LCDCON1(0X4D000000)
it contains following fields:

FIELD      	BIT        	  DESCRIPTION

LINECNT 	[27:18]    Provide the status of the line counter. 
			   Down count from LINEVAL to 0. 

CLKVAL 		[17:8] 	   Determine the rates of VCLK and CLKVAL[9:0]. 

MMODE 		[7] 	   Determine the toggle rate of the VM. 
                           0 = Each Frame 
                           1 = The rate defined by the MVAL 

PNRMODE         [6:5]      Select the display mode.
			   00 = 4-bit dual scan display mode (STN)
			   01 = 4-bit single scan display mode (STN)
			   10 = 8-bit single scan display mode (STN)
			   11 = TFT LCD panel.

BPPMODE 	[4:1] 	   Select the BPP (Bits Per Pixel) mode.
			0000 = 1 bpp for STN, Monochrome mode
			0001 = 2 bpp for STN, 4-level gray mode
			0010 = 4 bpp for STN, 16-level gray mode
			0011 = 8 bpp for STN, color mode (256 color)
			0100 = packed 12 bpp for STN, color mode (4096 color)
			0101 = unpacked 12 bpp for STN, color mode (4096 color)
			0110 = 16 bpp for STN, color mode (4096 color)
			1000 = 1 bpp for TFT
			1001 = 2 bpp for TFT
			1010 = 4 bpp for TFT
			1011 = 8 bpp for TFT
			1100 = 16 bpp for TFT
			1101 = 24 bpp for TFT


ENVID		[0]	LCD video output and the logic enable/disable.
			0 = Disable the video output and the LCD control signal.
			1 = Enable the video output and the LCD control signal.





(II):> LCDCON2 (0X4D000004)

fields contains  

FIELD      	BIT        	  DESCRIPTION

VBPD		[31:24] 	TFT: Vertical back porch is the number of inactive lines at the start of 0x00
				a frame, after vertical synchronization period. 
				STN: These bits should be set to zero on STN LCD.

LINEVAL  	[23:14] 	TFT/STN: These bits determine the vertical size of LCD panel.


VFPD 		[13:6] 		TFT: Vertical front porch is the number of inactive lines at the end of
				a frame, before vertical synchronization period.
				STN: These bits should be set to zero on STN LCD

VSPW		[5:0]		TFT: Vertical sync pulse width determines the VSYNC pulse's high
				level width by counting the number of inactive lines.
				STN: These bits should be set to zero on STN LCD.


(III):> LCDCON3 (0X4D000008)

FIELD      	BIT        	  DESCRIPTION

HBPD (TFT)	[25:19] 	TFT: Horizontal back porch is the number of VCLK periods between 
				the falling edge of HSYNC and the start of active data. 

WDLY (STN)			STN: WDLY[1:0] bits determine the delay between VLINE and VCLK
				by counting the number of the HCLK. WDLY[7:2] are reserved.
				00 = 16 HCLK, 01 = 32 HCLK, 10 = 48 HCLK, 11 = 64 HCLK

HOZVAL 		[18:8]		TFT/STN: These bits determine the horizontal size of LCD panel.


HFPD (TFT)	[7:0]		TFT: Horizontal front porch is the number of VCLK periods between
				the end of active data and the rising edge of HSYNC.

LINEBLANK			STN: These bits indicate the blank time in one horizontal line
				duration time. These bits adjust the rate of the VLINE finely.
(STN)

(IV):>	LCDCON4(0X4D00000C)

FIELD      	BIT        	  DESCRIPTION

MVAL 		[15:8] 		STN: These bit define the rate at which the VM signal will toggle if 
				the MMODE bit is set to logic '1'. 


HSPW(TFT) 	[7:0] 		TFT: Horizontal sync pulse width determines the HSYNC pulse's 
				high level width by counting the number of the VCLK 

WLH(STN)			STN: WLH[1:0] bits determine the VLINE pulse's high level width by
				counting the number of the HCLK.
				WLH[7:2] are reserved.


(V):> LCDCON5(LCDCON5)


FIELD      	BIT        	  DESCRIPTION


VSTATUS 	[16:15] 	TFT: Vertical Status (read only). 
				00 = VSYNC 
				01 = BACK Porch 
				10 = ACTIVE 
				11 = FRONT Porch 

HSTATUS 	[14:13] 	TFT: Horizontal Status (read only). 
				00 = HSYNC 
				01 = BACK Porch 
				10 = ACTIVE 
				11 = FRONT Porch

BPP24BL 	[12] 		TFT: This bit determines the order of 24 bpp video memory. 
				0 = LSB valid 
				1 = MSB Valid

FRM565 		[11] 		TFT: This bit selects the format of 16 bpp output video data. 
				0 = 5:5:5:1 Format 
				1 = 5:6:5 Format

INVVCLK 	[10] 		STN/TFT: This bit controls the polarity of the VCLK active 
				edge. 
				0 = The video data is fetched at VCLK falling edge 
				1 = The video data is fetched at VCLK rising edge 

INVVLINE 	[9] 		STN/TFT: This bit indicates the VLINE/HSYNC pulse polarity. 
				0 = Normal 
				1 = Inverted 

INVVFRAME 	[8] 		STN/TFT: This bit indicates the VFRAME/VSYNC pulse 
				polarity. 
				0 = Normal 
				1 = Inverted 

INVVD 		[7] 		STN/TFT: This bit indicates the VD (video data) pulse polarity. 
				0 = Normal 
				1 = VD is inverted. 
 

INVVDEN 	[6] 		TFT: This bit indicates the VDEN signal polarity. 
				0 = normal 
				1 = inverted 

INVPWREN 	[5] 		STN/TFT: This bit indicates the PWREN signal polarity. 
				0 = normal 
				1 = inverted 

INVLEND 	[4] 		TFT: This bit indicates the LEND signal polarity. 
    				0 = normal 
    				1 = inverted
 
PWREN 		[3] 		STN/TFT: LCD_PWREN output signal enable/disable. 
          			0 = Disable PWREN signal 
          			1 = Enable PWREN signal 

ENLEND 		[2] 		TFT: LEND output signal enable/disable. 
   			        0 = Disable LEND signal 
           			1 = Enable LEND signal 

BSWP 		[1] 		STN/TFT: Byte swap control bit. 
         			0 = Swap Disable 
         			1 = Swap Enable
 
HWSWP 		[0] 		STN/TFT: Half-Word swap control bit. 
          			0 = Swap Disable 
          			1 = Swap Enable 
 
 















 




